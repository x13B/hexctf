// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  // url      = env("DATABASE_URL")
  url = "file:hexctf/prisma/hexctfDatabase.db"
}

// schema.prisma
model User {
  id       Int  @id @unique
  username String  @unique
  //password String
  isAdmin  Boolean @default(false)
  Results  QuizResults[] @relation("UserToResults")
  auth_session Session[]
  key          Key[]
}

// For Lucia
model Session {
  id             Int @id @unique
  user_id        Int
  active_expires BigInt
  idle_expires   BigInt
  user           User   @relation(references: [id], fields: [user_id], onDelete: Cascade)

  @@index([user_id])
}

model Key {
  id              Int  @id @unique
  hashed_password String?
  user_id         Int
  user            User    @relation(references: [id], fields: [user_id], onDelete: Cascade)

  @@index([user_id])
}

model Teams {
  TeamId   Int          @id @default(autoincrement())
  TeamName String       @unique
  leader   Leaderboard? @relation("TeamToLeaderboard")
  answers  AnswerQuestions[] @relation("TeamToAnswer")
}

model Leaderboard {
  TeamId  Int    @id
  Teams   Teams  @relation("TeamToLeaderboard", fields: [TeamId], references: [TeamId])
}

model Categories {
  CategoryId   Int    @id
  CategoryName String @unique
  Questions Questions[] @relation("CategoryToQuestion")
}

model Questions {
  QuestionId  Int    @id
  Description String 
  Answer      String
  points      Int
  categoryId  Int 
  Categories Categories @relation("CategoryToQuestion", fields: [categoryId], references: [CategoryId])
  anwers     AnswerQuestions[] @relation("QuestionToAnswer")
}

model AnswerQuestions {
  AnswerId   Int @id
  QuestionId Int 
  TeamId     Int
  Questions  Questions @relation("QuestionToAnswer", fields: [QuestionId], references: [QuestionId])
  Teams      Teams     @relation("TeamToAnswer", fields: [TeamId], references: [TeamId])
}

model Quiz {
  quizId   Int     @id
  quizName String  @unique
  results  QuizResults[] @relation("QuizToResults")
}

model QuizResults {
  quizId Int 
  UserId Int
  score  Int @default(-1)
  Quiz   Quiz @relation("QuizToResults", fields: [quizId], references: [quizId])
  User   User @relation("UserToResults", fields: [UserId], references: [id])
  @@unique([quizId, UserId])
}