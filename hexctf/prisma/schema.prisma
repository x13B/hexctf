// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// NOTE: USE PascalCase for model name and camelCase for field names!

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  // url      = env("DATABASE_URL")
  url = "file:hexctf/prisma/hexctfDatabase.db"
}

// schema.prisma
model User {
  id       String  @id @unique
  username String  @unique
  isAdmin  Boolean @default(false)
  results  QuizResults[] @relation("UserToResults")
  auth_session Session[]
  key          Key[]
}

// For Lucia
model Session {
  id             String @id @unique
  user_id        String
  active_expires BigInt
  idle_expires   BigInt
  user           User   @relation(references: [id], fields: [user_id], onDelete: Cascade)

  @@index([user_id])
}

model Key {
  id              String  @id @unique
  hashed_password String?
  user_id         String
  user            User    @relation(references: [id], fields: [user_id], onDelete: Cascade)

  @@index([user_id])
}

model Teams {
  teamId   Int          @id @default(autoincrement())
  teamName String       @unique
  answers  AnswerQuestions[] @relation("TeamToAnswer")
  teams Leaderboard? @relation("TeamToLeaderboard")
}

model Leaderboard {
  teamId  Int    @id
  teams   Teams  @relation("TeamToLeaderboard", fields: [teamId], references: [teamId])
}

model Categories {
  categoryId   Int    @id @default(autoincrement())
  categoryName String @unique
  questions Questions[] @relation("CategoryToQuestion")
}

model Questions {
  questionId  Int    @id @default(autoincrement())
  description String 
  answer      String
  points      Int
  categoryId  Int 
  difficuly   String
  categories  Categories @relation("CategoryToQuestion", fields: [categoryId], references: [categoryId])
  answers     AnswerQuestions[] @relation("QuestionToAnswer")
}

model AnswerQuestions {
  answerId   Int @id @default(autoincrement())
  questionId Int 
  teamId     Int
  questions  Questions @relation("QuestionToAnswer", fields: [questionId], references: [questionId])
  teams      Teams     @relation("TeamToAnswer", fields: [teamId], references: [teamId])
}

model Quiz {
  quizId   Int     @id @default(autoincrement())
  quizName String  @unique
  results  QuizResults[] @relation("QuizToResults")
}

model QuizQuestions {
  quizQuestionsId Int @id @default(autoincrement())
  questionBody    String
  questionAnswer  String
  category        String
}

model QuizResults {
  quizId Int 
  userId String
  score  Int @default(-1)
  quiz   Quiz @relation("QuizToResults", fields: [quizId], references: [quizId])
  user   User @relation("UserToResults", fields: [userId], references: [id])
  @@unique([quizId, userId])
}